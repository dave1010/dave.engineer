---
layout: base.njk
---
{% set postsToRender = posts | default([]) %}
{% if (postsToRender | length) == 0 and collections.blog %}
  {% set postsToRender = collections.blog | reverse %}
{% endif %}
{% set typeGroups = collections.blogPostsByType | default([]) %}
{% set totalCount = 0 %}
{% for group in typeGroups %}
  {% set totalCount = totalCount + (group.count | default(group.items | length)) %}
{% endfor %}
{% set tagList = collections.blogTags | default([]) %}
<div class="relative px-6 pb-24 pt-10 sm:px-10">
  <div class="mx-auto flex max-w-6xl flex-col gap-14">
    <header class="relative isolate overflow-hidden rounded-[2.5rem] border border-cyan-500/20 bg-slate-950/80 p-10 clip-diagonal">
      <div class="pointer-events-none absolute inset-0 opacity-60">
        <div class="absolute -left-24 top-8 h-64 w-64 rounded-full bg-cyan-500/25 blur-3xl"></div>
        <div class="absolute -right-16 bottom-8 h-56 w-56 rotate-12 rounded-3xl border border-fuchsia-500/20"></div>
      </div>
      <div class="relative flex flex-col gap-5">
        <a class="inline-flex items-center gap-2 font-tech text-xs uppercase tracking-[0.45em] text-cyan-200/80 transition hover:text-cyan-100" href="/">
          <span aria-hidden="true">←</span>
          Back to index
        </a>
        <div class="space-y-3">
          <p class="font-tech text-xs uppercase tracking-[0.6em] text-cyan-200/70">Archive feed</p>
          <h1 class="font-display text-4xl font-semibold text-slate-50 sm:text-5xl">{{ listTitle or "Writing" }}</h1>
          {% if listDescription %}
            <p class="text-lg text-slate-300/90">{{ listDescription }}</p>
          {% endif %}
        </div>
      </div>
    </header>

    {% if typeGroups | length %}
    <nav aria-label="Filter posts by type" class="space-y-3">
      <p class="font-tech text-[0.65rem] uppercase tracking-[0.5em] text-slate-400">Filter by type</p>
      <ul class="flex flex-wrap gap-2">
        <li>
          {% set isAllActive = not currentType %}
          <a
            href="/blog/"
            class="inline-flex items-center gap-2 rounded-full border border-cyan-500/30 px-4 py-2 font-tech text-[0.7rem] uppercase tracking-[0.35em] text-cyan-200 transition hover:border-cyan-400 hover:text-cyan-100 {{ "border-cyan-400/80 bg-cyan-500/10" if isAllActive }}"
            {% if isAllActive %}aria-current="page"{% endif %}
          >
            All
            <span class="rounded-full border border-cyan-500/20 bg-slate-900/80 px-2 py-0.5 font-tech text-[0.6rem] tracking-[0.35em] text-cyan-200/80">{{ totalCount }}</span>
          </a>
        </li>
        {% for group in typeGroups %}
        <li>
          {% set isActive = currentType == group.type %}
          {% set badgeClasses = "" %}
          {% if group.type == "post" %}
            {% set badgeClasses = "border-cyan-400/70 bg-cyan-500/10 text-cyan-100" %}
          {% elseif group.type == "til" %}
            {% set badgeClasses = "border-emerald-400/70 bg-emerald-500/10 text-emerald-100" %}
          {% elseif group.type == "external" %}
            {% set badgeClasses = "border-amber-400/70 bg-amber-500/10 text-amber-100" %}
          {% endif %}
          <a
            href="{{ group.permalink }}"
            class="inline-flex items-center gap-2 rounded-full border border-slate-800/70 px-4 py-2 font-tech text-[0.7rem] uppercase tracking-[0.35em] text-slate-300 transition hover:border-cyan-400 hover:text-cyan-100 {{ badgeClasses if isActive }}"
            {% if isActive %}aria-current="page"{% endif %}
          >
            {{ group.label }}
            <span class="rounded-full border border-slate-700/60 bg-slate-900/80 px-2 py-0.5 font-tech text-[0.6rem] tracking-[0.35em] text-slate-400">{{ group.count }}</span>
          </a>
        </li>
        {% endfor %}
      </ul>
    </nav>
    {% endif %}

    {% if tagList | length %}
    <section class="space-y-3">
      <p class="font-tech text-[0.65rem] uppercase tracking-[0.5em] text-slate-400">Browse by tag</p>
      <div class="flex flex-wrap gap-2">
        {% for tag in tagList %}
        {% set isCurrentTag = currentTagSlug and currentTagSlug == tag.slug %}
        <a
          href="{{ tag.permalink }}"
          class="inline-flex items-center gap-2 rounded-full border border-slate-800/70 px-4 py-2 font-tech text-[0.7rem] uppercase tracking-[0.35em] text-slate-300 transition hover:border-fuchsia-400 hover:text-fuchsia-200 {{ "border-fuchsia-400/80 bg-fuchsia-500/10 text-fuchsia-100" if isCurrentTag }}"
          {% if isCurrentTag %}aria-current="page"{% endif %}
        >
          {{ tag.name }}
          <span class="rounded-full border border-slate-700/60 bg-slate-900/80 px-2 py-0.5 font-tech text-[0.6rem] tracking-[0.35em] text-slate-400">{{ tag.count }}</span>
        </a>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    {% if content | trim %}
      <div class="prose prose-invert max-w-none">{{ content | safe }}</div>
    {% endif %}

    <div class="grid gap-6">
      {% if postsToRender | length %}
        {% for post in postsToRender %}
        <article class="group relative overflow-hidden rounded-[2rem] border border-slate-800/70 bg-slate-950/75 p-8 transition hover:border-cyan-400/40 hover:shadow-neon-cyan">
          <div class="pointer-events-none absolute inset-0 opacity-50">
            <div class="absolute -right-16 top-10 h-48 w-48 rounded-full bg-cyan-500/15 blur-3xl transition group-hover:bg-cyan-400/25"></div>
            <div class="absolute -left-16 bottom-8 h-40 w-40 rotate-12 rounded-3xl border border-fuchsia-500/20"></div>
          </div>
          <div class="relative flex flex-col gap-5">
            <div class="flex flex-wrap items-center justify-between gap-4 text-[0.75rem] text-slate-400/90">
              <div class="flex flex-wrap items-center gap-3">
                {% set typeClass = "border-cyan-400/60 bg-cyan-500/10 text-cyan-100" %}
                {% if post.data.type == "til" %}
                  {% set typeClass = "border-emerald-400/60 bg-emerald-500/10 text-emerald-100" %}
                {% elseif post.data.type == "external" %}
                  {% set typeClass = "border-amber-400/60 bg-amber-500/10 text-amber-100" %}
                {% endif %}
                {% set typeLabel = post.data.typeLabel %}
                {% if not typeLabel %}
                  {% if post.data.type == "til" %}
                    {% set typeLabel = "Today I Learned" %}
                  {% elseif post.data.type == "external" %}
                    {% set typeLabel = "Elsewhere" %}
                  {% else %}
                    {% set typeLabel = "Blog Post" %}
                  {% endif %}
                {% endif %}
                <span class="inline-flex items-center gap-1 rounded-full border px-3 py-1 font-tech text-[0.65rem] uppercase tracking-[0.35em] {{ typeClass }}">
                  {{ typeLabel }}
                </span>
                <time datetime="{{ post.data.isoDate }}" class="font-tech text-[0.6rem] uppercase tracking-[0.35em] text-slate-400/80">{{ post.data.displayDate }}</time>
              </div>
              {% if post.data.topicTagLinks and post.data.topicTagLinks | length %}
              <ul class="flex flex-wrap gap-2">
                {% for tag in post.data.topicTagLinks %}
                <li>
                  <a
                    class="inline-flex items-center gap-2 rounded-full border border-slate-700/60 px-3 py-1 font-tech text-[0.6rem] uppercase tracking-[0.35em] text-slate-300 transition hover:border-fuchsia-400 hover:text-fuchsia-200"
                    href="{{ tag.url }}"
                  >
                    {{ tag.name }}
                  </a>
                </li>
                {% endfor %}
              </ul>
              {% endif %}
            </div>
            <h2 class="font-display text-3xl font-semibold text-slate-50">
              <a class="transition hover:text-cyan-200" href="{{ post.url }}">{{ post.data.title }}</a>
            </h2>
            {% set summary = post.data.excerpt %}
            {% if not summary and post.templateContent %}
              {% set summary = post.templateContent | striptags | truncate(220, true, "…") %}
            {% endif %}
            {% if summary %}
            <p class="max-w-3xl text-base text-slate-300/90">{{ summary }}</p>
            {% endif %}
            {% set sourceInfo = post.data.externalSourceInfo %}
            {% set ctaUrl = post.url %}
            {% set ctaLabel = "Read more" %}
            {% set ctaAttributes = "" %}
            {% if post.data.type == "external" and post.data.externalUrl %}
              {% set ctaUrl = post.data.externalUrl %}
              {% set ctaLabel = "Read externally" %}
              {% if sourceInfo and sourceInfo.ctaLabel %}
                {% set ctaLabel = sourceInfo.ctaLabel %}
              {% endif %}
              {% set ctaAttributes = " rel=\"noopener noreferrer\" target=\"_blank\"" %}
            {% endif %}
            <a class="inline-flex items-center gap-2 font-tech text-[0.7rem] uppercase tracking-[0.35em] text-cyan-200 transition hover:text-cyan-100" href="{{ ctaUrl }}"{{ ctaAttributes | safe }}>
              {{ ctaLabel }}
              <span aria-hidden="true">→</span>
            </a>
          </div>
        </article>
        {% endfor %}
      {% else %}
        <p class="rounded-3xl border border-slate-800/70 bg-slate-950/70 p-10 text-center font-tech text-[0.75rem] uppercase tracking-[0.35em] text-slate-400">No posts found.</p>
      {% endif %}
    </div>
  </div>
</div>
