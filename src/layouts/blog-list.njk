---
layout: base.njk
---
{% from "components/post-list.njk" import renderPostList %}
{% from "components/blog-meta.njk" import tagClasses, tagContainerClasses %}
{% set postsToRender = posts | default([]) %}
{% if (postsToRender | length) == 0 and collections.blog %}
  {% set postsToRender = collections.blog | reverse %}
{% endif %}
{% set typeGroups = collections.blogPostsByType | default([]) %}
{% set totalCount = 0 %}
{% for group in typeGroups %}
  {% set totalCount = totalCount + (group.count | default(group.items | length)) %}
{% endfor %}
{% set tagList = collections.blogTags | default([]) %}
{% set tagLinkClasses = tagClasses() %}
{% set tagCountClasses = "rounded-full border border-slate-700/60 bg-slate-950/60 px-2 py-0.5 text-[0.65rem] font-medium text-slate-400" %}
{% set paginationButtonClasses = "inline-flex items-center gap-2 rounded-full border border-slate-700/60 bg-slate-900/60 px-3 py-1 text-sm font-medium text-slate-300 transition hover:border-slate-600 hover:text-slate-100" %}
{% set paginationActiveClasses = "border-sky-500/80 text-sky-200" %}
<main class="px-6 py-16 sm:px-10">
  <div class="mx-auto flex max-w-4xl flex-col gap-12">
    <header class="space-y-4">
      <a
        class="inline-flex items-center gap-2 text-sm font-medium text-sky-400 hover:text-sky-300"
        href="/"
      >
        <span aria-hidden="true">←</span>
        Back to home
      </a>
      <p class="text-sm font-medium uppercase tracking-[0.2em] text-slate-400">Archive</p>
      <h1 class="text-4xl font-semibold tracking-tight text-slate-100">{{ listTitle or "Writing" }}</h1>
      {% if listDescription %}
        <p class="text-lg text-slate-300">{{ listDescription }}</p>
      {% endif %}
    </header>

    {% if typeGroups | length %}
    <nav aria-label="Filter posts by type" class="flex flex-col gap-3">
      <p class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Filter by type</p>
      <ul class="flex flex-wrap gap-2">
        <li>
          {% set isAllActive = not currentType %}
          <a
            href="/blog/"
            class="inline-flex items-center gap-2 rounded-full border border-slate-800/70 bg-slate-900/60 px-4 py-2 text-xs font-semibold uppercase tracking-wide transition hover:border-slate-700 hover:text-slate-100 {{ "border-sky-500/80 text-sky-200" if isAllActive }}"
            {% if isAllActive %}aria-current="page"{% endif %}
          >
            All
            <span class="rounded-full border border-slate-700/60 bg-slate-950/60 px-2 py-0.5 text-[0.65rem] font-medium text-slate-400">{{ totalCount }}</span>
          </a>
        </li>
        {% for group in typeGroups %}
        <li>
          {% set isActive = currentType == group.type %}
          {% set badgeClasses = "" %}
          {% if group.type == "post" %}
            {% set badgeClasses = "border-sky-500/80 text-sky-200" %}
          {% elseif group.type == "til" %}
            {% set badgeClasses = "border-lime-500/80 text-lime-200" %}
          {% elseif group.type == "external" %}
            {% set badgeClasses = "border-amber-500/80 text-amber-200" %}
          {% endif %}
          <a
            href="{{ group.permalink }}"
            class="inline-flex items-center gap-2 rounded-full border border-slate-800/70 bg-slate-900/60 px-4 py-2 text-xs font-semibold uppercase tracking-wide transition hover:border-slate-700 hover:text-slate-100 {{ badgeClasses if isActive }}"
            {% if isActive %}aria-current="page"{% endif %}
          >
            {{ group.label }}
            <span class="rounded-full border border-slate-700/60 bg-slate-950/60 px-2 py-0.5 text-[0.65rem] font-medium text-slate-400">{{ group.count }}</span>
          </a>
        </li>
        {% endfor %}
      </ul>
    </nav>
    {% endif %}

    {% if tagList | length %}
    {% set tagPreview = tagList.slice(0, 12) %}
    <section class="space-y-3">
      <div class="flex items-center justify-between gap-4">
        <p class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Browse by tag</p>
        <a class="text-xs font-semibold tracking-wide text-sky-300 transition hover:text-sky-200" href="/blog/tag/">View all tags →</a>
      </div>
      <div class="{{ tagContainerClasses() }}">
        {% for tag in tagPreview %}
        {% set isCurrentTag = currentTagSlug and currentTagSlug == tag.slug %}
        <a
          href="{{ tag.permalink }}"
          class="{{ tagLinkClasses }} {{ "border-sky-500/80 text-sky-200" if isCurrentTag }}"
          {% if isCurrentTag %}aria-current="page"{% endif %}
        >
          {{ tag.name | lower }}
          <span class="{{ tagCountClasses }}">{{ tag.count }}</span>
        </a>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    {% if content | trim %}
      <div class="prose prose-invert max-w-none">{{ content | safe }}</div>
    {% endif %}

    {{ renderPostList(postsToRender, {
      tagLinkClasses: tagLinkClasses,
      showEmptyMessage: true,
      emptyMessage: "No posts found."
    }) | safe }}

    {% if listingPagination and listingPagination.totalPages > 1 %}
    <nav aria-label="Pagination" class="flex flex-col items-center gap-3 pt-6">
      <p class="text-sm text-slate-400">Page {{ listingPagination.currentPage }} of {{ listingPagination.totalPages }}</p>
      <div class="flex flex-wrap items-center justify-center gap-3">
        {% if listingPagination.previous %}
        <a class="{{ paginationButtonClasses }}" href="{{ listingPagination.previous.url }}">
          <span aria-hidden="true">←</span>
          Newer posts
        </a>
        {% endif %}
        <ul class="flex flex-wrap items-center gap-2">
          {% for pageLink in listingPagination.pages %}
          <li>
            {% if pageLink.isCurrent %}
            <span class="{{ paginationButtonClasses }} {{ paginationActiveClasses }}" aria-current="page">{{ pageLink.number }}</span>
            {% else %}
            <a class="{{ paginationButtonClasses }}" href="{{ pageLink.url }}">{{ pageLink.number }}</a>
            {% endif %}
          </li>
          {% endfor %}
        </ul>
        {% if listingPagination.next %}
        <a class="{{ paginationButtonClasses }}" href="{{ listingPagination.next.url }}">
          Older posts
          <span aria-hidden="true">→</span>
        </a>
        {% endif %}
      </div>
    </nav>
    {% endif %}
  </div>
</main>
